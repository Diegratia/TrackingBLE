using Microsoft.AspNetCore.Builder;
using Microsoft.Extensions.Configuration;
using TrackingBle.src._4FloorplanMaskedArea;
using TrackingBle.src._13MstFloor;
using TrackingBle.src._14MstFloorplan;

var builder = WebApplication.CreateBuilder(args);

// load config
builder.Configuration
    .AddJsonFile("appsettings.Development.json", optional: false)
    .AddJsonFile($"appsettings.{builder.Envirsonment.EnvironmentName}.json", optional: true)
    .AddEnvironmentVariables();

// ambil port dari config
var floorplanMaskedAreaPort = builder.Configuration["Ports:FloorplanMaskedAreaService"] ?? "5000";
var mstFloorPort = builder.Configuration["Ports:MstFloorService"] ?? "5013";
var mstFloorplanPort = builder.Configuration["Ports:MstFloorplanService"] ?? "5014";

// run dalam task terpisah
var tasks = new List<Task>
{
    Task.Run(() => FloorplanMaskedAreaProgram.Run(builder.Configuration, floorplanMaskedAreaPort)),
    Task.Run(() => MstFloorProgram.Run(builder.Configuration, mstFloorPort)),
    Task.Run(() => MstFloorplanProgram.Run(builder.Configuration, mstFloorplanPort))
};

// tunggu semua selesai
await Task.WhenAll(tasks);