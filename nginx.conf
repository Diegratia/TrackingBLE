events {}

http {
    server {
        listen 5000;
        # server_name localhost;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        # jika reverse proxy, nginx perlu neruskan authorization dari client ke
        proxy_set_header Authorization $http_authorization;
        proxy_pass_header Authorization;

        if ($request_method = 'OPTIONS') {
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS';
            add_header 'Access-Control-Allow-Headers' 'Authorization, Content-Type';
            # add_header 'Access-Control-Allow-Credentials' 'true';
            add_header 'Content-Length' 0;
            return 204;
        }

        location /api/Auth {
            # haurs tambah / diujung url
            # p.s penambahan rewrite membuat client harus menambahkan "/"
            rewrite /api/Auth/(.*) /$1 break;
            proxy_pass http://auth:5001;
        }

        location /api/FloorplanMaskedArea {

            rewrite /api/FloorplanMaskedArea/(.*) /$1 break;
            proxy_pass http://floorplan-masked-area:5004;
        }

        location /api/MstAccessCctv {
            rewrite /api/MstAccessCctv/(.*) /$1 break;
            proxy_pass http://mst-accesscctv:5005;
        }

        location /api/MstAccessControl {
            rewrite /api/MstAccessControl/(.*) /$1 break;
            proxy_pass http://mst-accesscontrol:5006;
        }

        location /api/MstApplication {
            # header cors untuk semua respons
            # proxy_pass_header 'Access-Control-Allow-Origin';
            # proxy_pass_header 'Access-Control-Allow-Methods';
            # proxy_pass_header 'Access-Control-Allow-Headers';
            rewrite /api/MstApplication/(.*) /$1 break;
            proxy_pass http://mst-application:5007;

            # add_header 'Access-Control-Allow-Origin' '*';
            # add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS';
            # add_header 'Access-Control-Allow-Headers' 'Authorization, Content-Type';
            # add_header 'Access-Control-Allow-Credentials' 'true';
        }

        location /api/MstBleReader {
            rewrite /api/MstBleReader/(.*) /$1 break;
            proxy_pass http://mst-blereader:5008;
        }

        location /api/MstBrand {

            rewrite /api/MstBrand/(.*) /$1 break;
            proxy_pass http://mst-brand:5009;
        }

        location /api/MstBuilding {

            rewrite /api/MstBuilding/(.*) /$1 break;
            proxy_pass http://mst-building:5010;
        }

        location /api/MstDepartment {

            rewrite /api/MstDepartment/(.*) /$1 break;
            proxy_pass http://mst-department:5011;
        }

        location /api/MstDistrict {

            rewrite /api/MstDistrict/(.*) /$1 break;
            proxy_pass http://mst-district:5012;
        }

        location /api/MstFloor {

            rewrite /api/MstFloor/(.*) /$1 break;
            proxy_pass http://mst-floor:5013;
        }

        location /api/MstFloorplan {

            rewrite /api/MstFloorplan/(.*) /$1 break;
            proxy_pass http://mst-floorplan:5014;
        }

        location /api/MstIntegration {

            rewrite /api/MstIntegration/(.*) /$1 break;
            proxy_pass http://mst-integration:5015;
        }

        location /api/MstMember {

            rewrite /api/MstMember/(.*) /$1 break;
            proxy_pass http://mst-member:5016;
        }

        location /api/MstOrganization {

            rewrite /api/MstOrganization/(.*) /$1 break;
            proxy_pass http://mst-organization:5017;
        }

        location /api/TrackingTransaction {

            rewrite /api/TrackingTransaction/(.*) /$1 break;
            proxy_pass http://tracking-transaction:5018;
        }

        location /api/Visitor {

            rewrite /api/Visitor/(.*) /$1 break;
            proxy_pass http://visitor:5019;
        }

        location /api/VisitorBlacklistArea {

            rewrite /api/VisitorBlacklistArea/(.*) /$1 break;
            proxy_pass http://visitor-blacklist-area:5020;
        }

        location /api/AlarmRecordTracking {

            rewrite /api/AlarmRecordTracking/(.*) /$1 break;
            proxy_pass http://alarm-record-tracking:5002;
        }
    }
}